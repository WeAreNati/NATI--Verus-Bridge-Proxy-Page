{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Identity = exports.IDENTITY_MAX_NAME_LEN = exports.IDENTITY_MAX_UNLOCK_DELAY = exports.IDENTITY_FLAG_TOKENIZED_CONTROL = exports.IDENTITY_FLAG_LOCKED = exports.IDENTITY_FLAG_ACTIVECURRENCY = exports.IDENTITY_FLAG_REVOKED = exports.IDENITTY_VERSION_INVALID = exports.IDENTITY_VERSION_PBAAS = exports.IDENTITY_VERSION_VAULT = void 0;\nconst varuint_1 = require(\"../utils/varuint\");\nconst bufferutils_1 = require(\"../utils/bufferutils\");\nconst Principal_1 = require(\"./Principal\");\nconst address_1 = require(\"../utils/address\");\nconst vdxf_1 = require(\"../constants/vdxf\");\nconst bn_js_1 = require(\"bn.js\");\nconst IdentityID_1 = require(\"./IdentityID\");\nconst SaplingPaymentAddress_1 = require(\"./SaplingPaymentAddress\");\nconst ContentMultiMap_1 = require(\"./ContentMultiMap\");\nconst KeyID_1 = require(\"./KeyID\");\nexports.IDENTITY_VERSION_VAULT = new bn_js_1.BN(2, 10);\nexports.IDENTITY_VERSION_PBAAS = new bn_js_1.BN(3, 10);\nexports.IDENITTY_VERSION_INVALID = new bn_js_1.BN(0, 10);\nexports.IDENTITY_FLAG_REVOKED = new bn_js_1.BN(\"8000\", 16); // set when this identity is revoked\nexports.IDENTITY_FLAG_ACTIVECURRENCY = new bn_js_1.BN(\"1\", 16); // flag that is set when this ID is being used as an active currency name\nexports.IDENTITY_FLAG_LOCKED = new bn_js_1.BN(\"2\", 16); // set when this identity is locked\nexports.IDENTITY_FLAG_TOKENIZED_CONTROL = new bn_js_1.BN(\"4\", 16); // set when revocation/recovery over this identity can be performed by anyone who controls its token\nexports.IDENTITY_MAX_UNLOCK_DELAY = new bn_js_1.BN(60).mul(new bn_js_1.BN(24)).mul(new bn_js_1.BN(22)).mul(new bn_js_1.BN(365)); // 21+ year maximum unlock time for an ID w/1 minute blocks, not adjusted for avg blocktime in first PBaaS\nexports.IDENTITY_MAX_NAME_LEN = new bn_js_1.BN(64);\nconst {\n  BufferReader,\n  BufferWriter\n} = bufferutils_1.default;\nclass Identity extends Principal_1.Principal {\n  constructor(data) {\n    super(data);\n    if (data === null || data === void 0 ? void 0 : data.parent) this.parent = data.parent;\n    if (data === null || data === void 0 ? void 0 : data.system_id) this.system_id = data.system_id;\n    if (data === null || data === void 0 ? void 0 : data.name) this.name = data.name;\n    if (data === null || data === void 0 ? void 0 : data.content_map) this.content_map = data.content_map;else this.content_map = new Map();\n    if (data === null || data === void 0 ? void 0 : data.content_multimap) this.content_multimap = data.content_multimap;else this.content_multimap = new ContentMultiMap_1.ContentMultiMap({\n      kv_content: new Map()\n    });\n    if (data === null || data === void 0 ? void 0 : data.revocation_authority) this.revocation_authority = data.revocation_authority;\n    if (data === null || data === void 0 ? void 0 : data.recovery_authority) this.recovery_authority = data.recovery_authority;\n    if (data === null || data === void 0 ? void 0 : data.private_addresses) this.private_addresses = data.private_addresses;\n    if (data === null || data === void 0 ? void 0 : data.unlock_after) this.unlock_after = data.unlock_after;\n  }\n  getByteLength() {\n    let length = 0;\n    length += super.getByteLength();\n    length += this.parent.getByteLength();\n    const nameLength = Buffer.from(this.name, \"utf8\").length;\n    length += varuint_1.default.encodingLength(nameLength);\n    length += nameLength;\n    if (this.version.gte(exports.IDENTITY_VERSION_PBAAS)) {\n      length += this.content_multimap.getByteLength();\n    }\n    if (this.version.lt(exports.IDENTITY_VERSION_PBAAS)) {\n      length += varuint_1.default.encodingLength(this.content_map.size);\n      for (const m of this.content_map.entries()) {\n        length += 20; //uint160 key\n        length += 32; //uint256 hash\n      }\n    }\n    length += varuint_1.default.encodingLength(this.content_map.size);\n    for (const m of this.content_map.entries()) {\n      length += 20; //uint160 key\n      length += 32; //uint256 hash\n    }\n    length += this.revocation_authority.getByteLength(); //uint160 revocation authority\n    length += this.recovery_authority.getByteLength(); //uint160 recovery authority\n    // privateaddresses\n    length += varuint_1.default.encodingLength(this.private_addresses ? this.private_addresses.length : 0);\n    if (this.private_addresses) {\n      for (const n of this.private_addresses) {\n        length += n.getByteLength();\n      }\n    }\n    // post PBAAS\n    if (this.version.gte(exports.IDENTITY_VERSION_VAULT)) {\n      length += this.system_id.getByteLength(); //uint160 systemid\n      length += 4; //uint32 unlockafter\n    }\n    return length;\n  }\n  toBuffer() {\n    const writer = new BufferWriter(Buffer.alloc(this.getByteLength()));\n    writer.writeSlice(super.toBuffer());\n    writer.writeSlice(this.parent.toBuffer());\n    writer.writeVarSlice(Buffer.from(this.name, \"utf8\"));\n    //contentmultimap\n    if (this.version.gte(exports.IDENTITY_VERSION_PBAAS)) {\n      writer.writeSlice(this.content_multimap.toBuffer());\n    }\n    //contentmap\n    if (this.version.lt(exports.IDENTITY_VERSION_PBAAS)) {\n      writer.writeCompactSize(this.content_map.size);\n      for (const [key, value] of this.content_map.entries()) {\n        writer.writeSlice((0, address_1.fromBase58Check)(key).hash);\n        writer.writeSlice(value);\n      }\n    }\n    //contentmap2\n    writer.writeCompactSize(this.content_map.size);\n    for (const [key, value] of this.content_map.entries()) {\n      writer.writeSlice((0, address_1.fromBase58Check)(key).hash);\n      writer.writeSlice(value);\n    }\n    writer.writeSlice(this.revocation_authority.toBuffer());\n    writer.writeSlice(this.recovery_authority.toBuffer());\n    // privateaddresses\n    writer.writeCompactSize(this.private_addresses ? this.private_addresses.length : 0);\n    if (this.private_addresses) {\n      for (const n of this.private_addresses) {\n        writer.writeSlice(n.toBuffer());\n      }\n    }\n    // post PBAAS\n    if (this.version.gte(exports.IDENTITY_VERSION_VAULT)) {\n      writer.writeSlice(this.system_id.toBuffer());\n      writer.writeUInt32(this.unlock_after.toNumber());\n    }\n    return writer.buffer;\n  }\n  fromBuffer(buffer, offset = 0, multimapKeylists = []) {\n    const reader = new BufferReader(buffer, offset);\n    reader.offset = super.fromBuffer(reader.buffer, reader.offset);\n    const _parent = new IdentityID_1.IdentityID();\n    reader.offset = _parent.fromBuffer(reader.buffer, reader.offset);\n    this.parent = _parent;\n    this.name = Buffer.from(reader.readVarSlice()).toString('utf8');\n    //contentmultimap\n    if (this.version.gte(exports.IDENTITY_VERSION_PBAAS)) {\n      const multimap = new ContentMultiMap_1.ContentMultiMap();\n      reader.offset = multimap.fromBuffer(reader.buffer, reader.offset, multimapKeylists);\n      this.content_multimap = multimap;\n    }\n    // contentmap\n    if (this.version.lt(exports.IDENTITY_VERSION_PBAAS)) {\n      const contentMapSize = reader.readVarInt();\n      this.content_map = new Map();\n      for (var i = 0; i < contentMapSize.toNumber(); i++) {\n        const contentMapKey = (0, address_1.toBase58Check)(reader.readSlice(20), vdxf_1.I_ADDR_VERSION);\n        this.content_map.set(contentMapKey, reader.readSlice(32));\n      }\n    }\n    const contentMapSize = reader.readVarInt();\n    this.content_map = new Map();\n    for (var i = 0; i < contentMapSize.toNumber(); i++) {\n      const contentMapKey = (0, address_1.toBase58Check)(reader.readSlice(20), vdxf_1.I_ADDR_VERSION);\n      this.content_map.set(contentMapKey, reader.readSlice(32));\n    }\n    const _revocation = new IdentityID_1.IdentityID();\n    reader.offset = _revocation.fromBuffer(reader.buffer, reader.offset);\n    this.revocation_authority = _revocation;\n    const _recovery = new IdentityID_1.IdentityID();\n    reader.offset = _recovery.fromBuffer(reader.buffer, reader.offset);\n    this.recovery_authority = _recovery;\n    const numPrivateAddresses = reader.readVarInt();\n    if (numPrivateAddresses.gt(new bn_js_1.BN(0))) this.private_addresses = [];\n    for (var i = 0; i < numPrivateAddresses.toNumber(); i++) {\n      const saplingAddr = new SaplingPaymentAddress_1.SaplingPaymentAddress();\n      reader.offset = saplingAddr.fromBuffer(reader.buffer, reader.offset);\n      this.private_addresses.push(saplingAddr);\n    }\n    if (this.version.gte(exports.IDENTITY_VERSION_VAULT)) {\n      const _system = new IdentityID_1.IdentityID();\n      reader.offset = _system.fromBuffer(reader.buffer, reader.offset);\n      this.system_id = _system;\n      this.unlock_after = new bn_js_1.BN(reader.readUInt32(), 10);\n    } else {\n      this.system_id = _parent;\n      this.unlock_after = new bn_js_1.BN(0);\n    }\n    return reader.offset;\n  }\n  toJson() {\n    const contentmap = {};\n    for (const [key, value] of this.content_map.entries()) {\n      const valueCopy = Buffer.from(value);\n      contentmap[(0, address_1.fromBase58Check)(key).hash.reverse().toString('hex')] = valueCopy.reverse().toString('hex');\n    }\n    const ret = {\n      contentmap,\n      contentmultimap: this.content_multimap.toJson(),\n      flags: this.flags.toNumber(),\n      minimumsignatures: this.min_sigs.toNumber(),\n      name: this.name,\n      parent: this.parent.toAddress(),\n      primaryaddresses: this.primary_addresses.map(x => x.toAddress()),\n      recoveryauthority: this.recovery_authority.toAddress(),\n      revocationauthority: this.revocation_authority.toAddress(),\n      systemid: this.system_id.toAddress(),\n      timelock: this.unlock_after.toNumber(),\n      version: this.version.toNumber(),\n      identityaddress: this.getIdentityAddress()\n    };\n    if (this.private_addresses != null && this.private_addresses.length > 0) {\n      ret.privateaddress = this.private_addresses[0].toAddressString();\n    }\n    return ret;\n  }\n  getIdentityAddress() {\n    return (0, address_1.nameAndParentAddrToIAddr)(this.name, this.parent.toAddress());\n  }\n  isRevoked() {\n    return !!this.flags.and(exports.IDENTITY_FLAG_REVOKED).toNumber();\n  }\n  isLocked() {\n    return !!this.flags.and(exports.IDENTITY_FLAG_LOCKED).toNumber();\n  }\n  lock(unlockTime) {\n    let unlockAfter = unlockTime;\n    if (unlockTime.lte(new bn_js_1.BN(0))) {\n      unlockAfter = new bn_js_1.BN(1);\n    } else if (unlockTime.gt(exports.IDENTITY_MAX_UNLOCK_DELAY)) {\n      unlockAfter = exports.IDENTITY_MAX_UNLOCK_DELAY;\n    }\n    this.flags = this.flags.xor(exports.IDENTITY_FLAG_LOCKED);\n    this.unlock_after = unlockAfter;\n  }\n  unlock(height = new bn_js_1.BN(0), txExpiryHeight = new bn_js_1.BN(0)) {\n    if (this.isRevoked()) {\n      this.flags = this.flags.and(exports.IDENTITY_FLAG_LOCKED.notn(16));\n      this.unlock_after = new bn_js_1.BN(0);\n    } else if (this.isLocked()) {\n      this.flags = this.flags.and(exports.IDENTITY_FLAG_LOCKED.notn(16));\n      this.unlock_after = this.unlock_after.add(txExpiryHeight);\n    } else if (height.gt(this.unlock_after)) {\n      this.unlock_after = new bn_js_1.BN(0);\n    }\n    if (this.unlock_after.gt(txExpiryHeight.add(exports.IDENTITY_MAX_UNLOCK_DELAY))) {\n      this.unlock_after = txExpiryHeight.add(exports.IDENTITY_MAX_UNLOCK_DELAY);\n    }\n  }\n  revoke() {\n    this.flags = this.flags.xor(exports.IDENTITY_FLAG_REVOKED);\n    this.unlock();\n  }\n  unrevoke() {\n    this.flags = this.flags.and(exports.IDENTITY_FLAG_REVOKED.notn(16));\n  }\n  upgradeVersion(version = Identity.VERSION_CURRENT) {\n    if (version.eq(this.version)) return;\n    if (version.lt(this.version)) throw new Error(\"Cannot downgrade version\");\n    if (version.lt(Identity.VERSION_PBAAS)) throw new Error(\"Cannot upgrade to a version less than PBAAS\");\n    if (version.gt(Identity.VERSION_CURRENT)) throw new Error(\"Cannot upgrade to a version greater than the current known version\");\n    if (this.version.lt(Identity.VERSION_VAULT)) {\n      this.system_id = this.parent ? this.parent : IdentityID_1.IdentityID.fromAddress(this.getIdentityAddress());\n      this.version = Identity.VERSION_VAULT;\n    }\n    if (this.version.lt(Identity.VERSION_PBAAS)) {\n      this.version = Identity.VERSION_PBAAS;\n    }\n  }\n  static fromJson(json) {\n    const contentmap = new Map();\n    for (const key in json.contentmap) {\n      const reverseKey = Buffer.from(key, 'hex').reverse();\n      const iAddrKey = (0, address_1.toBase58Check)(reverseKey, vdxf_1.I_ADDR_VERSION);\n      contentmap.set(iAddrKey, Buffer.from(json.contentmap[key], 'hex').reverse());\n    }\n    return new Identity({\n      version: new bn_js_1.BN(json.version, 10),\n      flags: new bn_js_1.BN(json.flags, 10),\n      min_sigs: new bn_js_1.BN(json.minimumsignatures, 10),\n      primary_addresses: json.primaryaddresses.map(x => KeyID_1.KeyID.fromAddress(x)),\n      parent: IdentityID_1.IdentityID.fromAddress(json.parent),\n      system_id: json.systemid ? IdentityID_1.IdentityID.fromAddress(json.systemid) : undefined,\n      name: json.name,\n      content_map: contentmap,\n      content_multimap: ContentMultiMap_1.ContentMultiMap.fromJson(json.contentmultimap),\n      revocation_authority: IdentityID_1.IdentityID.fromAddress(json.revocationauthority),\n      recovery_authority: IdentityID_1.IdentityID.fromAddress(json.recoveryauthority),\n      private_addresses: json.privateaddress == null ? [] : [SaplingPaymentAddress_1.SaplingPaymentAddress.fromAddressString(json.privateaddress)],\n      unlock_after: new bn_js_1.BN(json.timelock, 10)\n    });\n  }\n}\nexports.Identity = Identity;\nIdentity.VERSION_INVALID = new bn_js_1.BN(0);\nIdentity.VERSION_VERUSID = new bn_js_1.BN(1);\nIdentity.VERSION_VAULT = new bn_js_1.BN(2);\nIdentity.VERSION_PBAAS = new bn_js_1.BN(3);\nIdentity.VERSION_CURRENT = Identity.VERSION_PBAAS;\nIdentity.VERSION_FIRSTVALID = new bn_js_1.BN(1);\nIdentity.VERSION_LASTVALID = new bn_js_1.BN(3);","map":{"version":3,"names":["Object","defineProperty","exports","value","Identity","IDENTITY_MAX_NAME_LEN","IDENTITY_MAX_UNLOCK_DELAY","IDENTITY_FLAG_TOKENIZED_CONTROL","IDENTITY_FLAG_LOCKED","IDENTITY_FLAG_ACTIVECURRENCY","IDENTITY_FLAG_REVOKED","IDENITTY_VERSION_INVALID","IDENTITY_VERSION_PBAAS","IDENTITY_VERSION_VAULT","varuint_1","require","bufferutils_1","Principal_1","address_1","vdxf_1","bn_js_1","IdentityID_1","SaplingPaymentAddress_1","ContentMultiMap_1","KeyID_1","BN","mul","BufferReader","BufferWriter","default","Principal","constructor","data","parent","system_id","name","content_map","Map","content_multimap","ContentMultiMap","kv_content","revocation_authority","recovery_authority","private_addresses","unlock_after","getByteLength","length","nameLength","Buffer","from","encodingLength","version","gte","lt","size","m","entries","n","toBuffer","writer","alloc","writeSlice","writeVarSlice","writeCompactSize","key","fromBase58Check","hash","writeUInt32","toNumber","buffer","fromBuffer","offset","multimapKeylists","reader","_parent","IdentityID","readVarSlice","toString","multimap","contentMapSize","readVarInt","i","contentMapKey","toBase58Check","readSlice","I_ADDR_VERSION","set","_revocation","_recovery","numPrivateAddresses","gt","saplingAddr","SaplingPaymentAddress","push","_system","readUInt32","toJson","contentmap","valueCopy","reverse","ret","contentmultimap","flags","minimumsignatures","min_sigs","toAddress","primaryaddresses","primary_addresses","map","x","recoveryauthority","revocationauthority","systemid","timelock","identityaddress","getIdentityAddress","privateaddress","toAddressString","nameAndParentAddrToIAddr","isRevoked","and","isLocked","lock","unlockTime","unlockAfter","lte","xor","unlock","height","txExpiryHeight","notn","add","revoke","unrevoke","upgradeVersion","VERSION_CURRENT","eq","Error","VERSION_PBAAS","VERSION_VAULT","fromAddress","fromJson","json","reverseKey","iAddrKey","KeyID","undefined","fromAddressString","VERSION_INVALID","VERSION_VERUSID","VERSION_FIRSTVALID","VERSION_LASTVALID"],"sources":["/Users/oddfl3x/Code/varB/NATIBridgeWebsite-main/node_modules/verus-typescript-primitives/dist/pbaas/Identity.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Identity = exports.IDENTITY_MAX_NAME_LEN = exports.IDENTITY_MAX_UNLOCK_DELAY = exports.IDENTITY_FLAG_TOKENIZED_CONTROL = exports.IDENTITY_FLAG_LOCKED = exports.IDENTITY_FLAG_ACTIVECURRENCY = exports.IDENTITY_FLAG_REVOKED = exports.IDENITTY_VERSION_INVALID = exports.IDENTITY_VERSION_PBAAS = exports.IDENTITY_VERSION_VAULT = void 0;\nconst varuint_1 = require(\"../utils/varuint\");\nconst bufferutils_1 = require(\"../utils/bufferutils\");\nconst Principal_1 = require(\"./Principal\");\nconst address_1 = require(\"../utils/address\");\nconst vdxf_1 = require(\"../constants/vdxf\");\nconst bn_js_1 = require(\"bn.js\");\nconst IdentityID_1 = require(\"./IdentityID\");\nconst SaplingPaymentAddress_1 = require(\"./SaplingPaymentAddress\");\nconst ContentMultiMap_1 = require(\"./ContentMultiMap\");\nconst KeyID_1 = require(\"./KeyID\");\nexports.IDENTITY_VERSION_VAULT = new bn_js_1.BN(2, 10);\nexports.IDENTITY_VERSION_PBAAS = new bn_js_1.BN(3, 10);\nexports.IDENITTY_VERSION_INVALID = new bn_js_1.BN(0, 10);\nexports.IDENTITY_FLAG_REVOKED = new bn_js_1.BN(\"8000\", 16); // set when this identity is revoked\nexports.IDENTITY_FLAG_ACTIVECURRENCY = new bn_js_1.BN(\"1\", 16); // flag that is set when this ID is being used as an active currency name\nexports.IDENTITY_FLAG_LOCKED = new bn_js_1.BN(\"2\", 16); // set when this identity is locked\nexports.IDENTITY_FLAG_TOKENIZED_CONTROL = new bn_js_1.BN(\"4\", 16); // set when revocation/recovery over this identity can be performed by anyone who controls its token\nexports.IDENTITY_MAX_UNLOCK_DELAY = new bn_js_1.BN(60).mul(new bn_js_1.BN(24)).mul(new bn_js_1.BN(22)).mul(new bn_js_1.BN(365)); // 21+ year maximum unlock time for an ID w/1 minute blocks, not adjusted for avg blocktime in first PBaaS\nexports.IDENTITY_MAX_NAME_LEN = new bn_js_1.BN(64);\nconst { BufferReader, BufferWriter } = bufferutils_1.default;\nclass Identity extends Principal_1.Principal {\n    constructor(data) {\n        super(data);\n        if (data === null || data === void 0 ? void 0 : data.parent)\n            this.parent = data.parent;\n        if (data === null || data === void 0 ? void 0 : data.system_id)\n            this.system_id = data.system_id;\n        if (data === null || data === void 0 ? void 0 : data.name)\n            this.name = data.name;\n        if (data === null || data === void 0 ? void 0 : data.content_map)\n            this.content_map = data.content_map;\n        else\n            this.content_map = new Map();\n        if (data === null || data === void 0 ? void 0 : data.content_multimap)\n            this.content_multimap = data.content_multimap;\n        else\n            this.content_multimap = new ContentMultiMap_1.ContentMultiMap({ kv_content: new Map() });\n        if (data === null || data === void 0 ? void 0 : data.revocation_authority)\n            this.revocation_authority = data.revocation_authority;\n        if (data === null || data === void 0 ? void 0 : data.recovery_authority)\n            this.recovery_authority = data.recovery_authority;\n        if (data === null || data === void 0 ? void 0 : data.private_addresses)\n            this.private_addresses = data.private_addresses;\n        if (data === null || data === void 0 ? void 0 : data.unlock_after)\n            this.unlock_after = data.unlock_after;\n    }\n    getByteLength() {\n        let length = 0;\n        length += super.getByteLength();\n        length += this.parent.getByteLength();\n        const nameLength = Buffer.from(this.name, \"utf8\").length;\n        length += varuint_1.default.encodingLength(nameLength);\n        length += nameLength;\n        if (this.version.gte(exports.IDENTITY_VERSION_PBAAS)) {\n            length += this.content_multimap.getByteLength();\n        }\n        if (this.version.lt(exports.IDENTITY_VERSION_PBAAS)) {\n            length += varuint_1.default.encodingLength(this.content_map.size);\n            for (const m of this.content_map.entries()) {\n                length += 20; //uint160 key\n                length += 32; //uint256 hash\n            }\n        }\n        length += varuint_1.default.encodingLength(this.content_map.size);\n        for (const m of this.content_map.entries()) {\n            length += 20; //uint160 key\n            length += 32; //uint256 hash\n        }\n        length += this.revocation_authority.getByteLength(); //uint160 revocation authority\n        length += this.recovery_authority.getByteLength(); //uint160 recovery authority\n        // privateaddresses\n        length += varuint_1.default.encodingLength(this.private_addresses ? this.private_addresses.length : 0);\n        if (this.private_addresses) {\n            for (const n of this.private_addresses) {\n                length += n.getByteLength();\n            }\n        }\n        // post PBAAS\n        if (this.version.gte(exports.IDENTITY_VERSION_VAULT)) {\n            length += this.system_id.getByteLength(); //uint160 systemid\n            length += 4; //uint32 unlockafter\n        }\n        return length;\n    }\n    toBuffer() {\n        const writer = new BufferWriter(Buffer.alloc(this.getByteLength()));\n        writer.writeSlice(super.toBuffer());\n        writer.writeSlice(this.parent.toBuffer());\n        writer.writeVarSlice(Buffer.from(this.name, \"utf8\"));\n        //contentmultimap\n        if (this.version.gte(exports.IDENTITY_VERSION_PBAAS)) {\n            writer.writeSlice(this.content_multimap.toBuffer());\n        }\n        //contentmap\n        if (this.version.lt(exports.IDENTITY_VERSION_PBAAS)) {\n            writer.writeCompactSize(this.content_map.size);\n            for (const [key, value] of this.content_map.entries()) {\n                writer.writeSlice((0, address_1.fromBase58Check)(key).hash);\n                writer.writeSlice(value);\n            }\n        }\n        //contentmap2\n        writer.writeCompactSize(this.content_map.size);\n        for (const [key, value] of this.content_map.entries()) {\n            writer.writeSlice((0, address_1.fromBase58Check)(key).hash);\n            writer.writeSlice(value);\n        }\n        writer.writeSlice(this.revocation_authority.toBuffer());\n        writer.writeSlice(this.recovery_authority.toBuffer());\n        // privateaddresses\n        writer.writeCompactSize(this.private_addresses ? this.private_addresses.length : 0);\n        if (this.private_addresses) {\n            for (const n of this.private_addresses) {\n                writer.writeSlice(n.toBuffer());\n            }\n        }\n        // post PBAAS\n        if (this.version.gte(exports.IDENTITY_VERSION_VAULT)) {\n            writer.writeSlice(this.system_id.toBuffer());\n            writer.writeUInt32(this.unlock_after.toNumber());\n        }\n        return writer.buffer;\n    }\n    fromBuffer(buffer, offset = 0, multimapKeylists = []) {\n        const reader = new BufferReader(buffer, offset);\n        reader.offset = super.fromBuffer(reader.buffer, reader.offset);\n        const _parent = new IdentityID_1.IdentityID();\n        reader.offset = _parent.fromBuffer(reader.buffer, reader.offset);\n        this.parent = _parent;\n        this.name = Buffer.from(reader.readVarSlice()).toString('utf8');\n        //contentmultimap\n        if (this.version.gte(exports.IDENTITY_VERSION_PBAAS)) {\n            const multimap = new ContentMultiMap_1.ContentMultiMap();\n            reader.offset = multimap.fromBuffer(reader.buffer, reader.offset, multimapKeylists);\n            this.content_multimap = multimap;\n        }\n        // contentmap\n        if (this.version.lt(exports.IDENTITY_VERSION_PBAAS)) {\n            const contentMapSize = reader.readVarInt();\n            this.content_map = new Map();\n            for (var i = 0; i < contentMapSize.toNumber(); i++) {\n                const contentMapKey = (0, address_1.toBase58Check)(reader.readSlice(20), vdxf_1.I_ADDR_VERSION);\n                this.content_map.set(contentMapKey, reader.readSlice(32));\n            }\n        }\n        const contentMapSize = reader.readVarInt();\n        this.content_map = new Map();\n        for (var i = 0; i < contentMapSize.toNumber(); i++) {\n            const contentMapKey = (0, address_1.toBase58Check)(reader.readSlice(20), vdxf_1.I_ADDR_VERSION);\n            this.content_map.set(contentMapKey, reader.readSlice(32));\n        }\n        const _revocation = new IdentityID_1.IdentityID();\n        reader.offset = _revocation.fromBuffer(reader.buffer, reader.offset);\n        this.revocation_authority = _revocation;\n        const _recovery = new IdentityID_1.IdentityID();\n        reader.offset = _recovery.fromBuffer(reader.buffer, reader.offset);\n        this.recovery_authority = _recovery;\n        const numPrivateAddresses = reader.readVarInt();\n        if (numPrivateAddresses.gt(new bn_js_1.BN(0)))\n            this.private_addresses = [];\n        for (var i = 0; i < numPrivateAddresses.toNumber(); i++) {\n            const saplingAddr = new SaplingPaymentAddress_1.SaplingPaymentAddress();\n            reader.offset = saplingAddr.fromBuffer(reader.buffer, reader.offset);\n            this.private_addresses.push(saplingAddr);\n        }\n        if (this.version.gte(exports.IDENTITY_VERSION_VAULT)) {\n            const _system = new IdentityID_1.IdentityID();\n            reader.offset = _system.fromBuffer(reader.buffer, reader.offset);\n            this.system_id = _system;\n            this.unlock_after = new bn_js_1.BN(reader.readUInt32(), 10);\n        }\n        else {\n            this.system_id = _parent;\n            this.unlock_after = new bn_js_1.BN(0);\n        }\n        return reader.offset;\n    }\n    toJson() {\n        const contentmap = {};\n        for (const [key, value] of this.content_map.entries()) {\n            const valueCopy = Buffer.from(value);\n            contentmap[(0, address_1.fromBase58Check)(key).hash.reverse().toString('hex')] = valueCopy.reverse().toString('hex');\n        }\n        const ret = {\n            contentmap,\n            contentmultimap: this.content_multimap.toJson(),\n            flags: this.flags.toNumber(),\n            minimumsignatures: this.min_sigs.toNumber(),\n            name: this.name,\n            parent: this.parent.toAddress(),\n            primaryaddresses: this.primary_addresses.map(x => x.toAddress()),\n            recoveryauthority: this.recovery_authority.toAddress(),\n            revocationauthority: this.revocation_authority.toAddress(),\n            systemid: this.system_id.toAddress(),\n            timelock: this.unlock_after.toNumber(),\n            version: this.version.toNumber(),\n            identityaddress: this.getIdentityAddress()\n        };\n        if (this.private_addresses != null && this.private_addresses.length > 0) {\n            ret.privateaddress = this.private_addresses[0].toAddressString();\n        }\n        return ret;\n    }\n    getIdentityAddress() {\n        return (0, address_1.nameAndParentAddrToIAddr)(this.name, this.parent.toAddress());\n    }\n    isRevoked() {\n        return !!(this.flags.and(exports.IDENTITY_FLAG_REVOKED).toNumber());\n    }\n    isLocked() {\n        return !!(this.flags.and(exports.IDENTITY_FLAG_LOCKED).toNumber());\n    }\n    lock(unlockTime) {\n        let unlockAfter = unlockTime;\n        if (unlockTime.lte(new bn_js_1.BN(0))) {\n            unlockAfter = new bn_js_1.BN(1);\n        }\n        else if (unlockTime.gt(exports.IDENTITY_MAX_UNLOCK_DELAY)) {\n            unlockAfter = exports.IDENTITY_MAX_UNLOCK_DELAY;\n        }\n        this.flags = this.flags.xor(exports.IDENTITY_FLAG_LOCKED);\n        this.unlock_after = unlockAfter;\n    }\n    unlock(height = new bn_js_1.BN(0), txExpiryHeight = new bn_js_1.BN(0)) {\n        if (this.isRevoked()) {\n            this.flags = this.flags.and(exports.IDENTITY_FLAG_LOCKED.notn(16));\n            this.unlock_after = new bn_js_1.BN(0);\n        }\n        else if (this.isLocked()) {\n            this.flags = this.flags.and(exports.IDENTITY_FLAG_LOCKED.notn(16));\n            this.unlock_after = this.unlock_after.add(txExpiryHeight);\n        }\n        else if (height.gt(this.unlock_after)) {\n            this.unlock_after = new bn_js_1.BN(0);\n        }\n        if (this.unlock_after.gt((txExpiryHeight.add(exports.IDENTITY_MAX_UNLOCK_DELAY)))) {\n            this.unlock_after = txExpiryHeight.add(exports.IDENTITY_MAX_UNLOCK_DELAY);\n        }\n    }\n    revoke() {\n        this.flags = this.flags.xor(exports.IDENTITY_FLAG_REVOKED);\n        this.unlock();\n    }\n    unrevoke() {\n        this.flags = this.flags.and(exports.IDENTITY_FLAG_REVOKED.notn(16));\n    }\n    upgradeVersion(version = Identity.VERSION_CURRENT) {\n        if (version.eq(this.version))\n            return;\n        if (version.lt(this.version))\n            throw new Error(\"Cannot downgrade version\");\n        if (version.lt(Identity.VERSION_PBAAS))\n            throw new Error(\"Cannot upgrade to a version less than PBAAS\");\n        if (version.gt(Identity.VERSION_CURRENT))\n            throw new Error(\"Cannot upgrade to a version greater than the current known version\");\n        if (this.version.lt(Identity.VERSION_VAULT)) {\n            this.system_id = this.parent ? this.parent : IdentityID_1.IdentityID.fromAddress(this.getIdentityAddress());\n            this.version = Identity.VERSION_VAULT;\n        }\n        if (this.version.lt(Identity.VERSION_PBAAS)) {\n            this.version = Identity.VERSION_PBAAS;\n        }\n    }\n    static fromJson(json) {\n        const contentmap = new Map();\n        for (const key in json.contentmap) {\n            const reverseKey = Buffer.from(key, 'hex').reverse();\n            const iAddrKey = (0, address_1.toBase58Check)(reverseKey, vdxf_1.I_ADDR_VERSION);\n            contentmap.set(iAddrKey, Buffer.from(json.contentmap[key], 'hex').reverse());\n        }\n        return new Identity({\n            version: new bn_js_1.BN(json.version, 10),\n            flags: new bn_js_1.BN(json.flags, 10),\n            min_sigs: new bn_js_1.BN(json.minimumsignatures, 10),\n            primary_addresses: json.primaryaddresses.map(x => KeyID_1.KeyID.fromAddress(x)),\n            parent: IdentityID_1.IdentityID.fromAddress(json.parent),\n            system_id: json.systemid ? IdentityID_1.IdentityID.fromAddress(json.systemid) : undefined,\n            name: json.name,\n            content_map: contentmap,\n            content_multimap: ContentMultiMap_1.ContentMultiMap.fromJson(json.contentmultimap),\n            revocation_authority: IdentityID_1.IdentityID.fromAddress(json.revocationauthority),\n            recovery_authority: IdentityID_1.IdentityID.fromAddress(json.recoveryauthority),\n            private_addresses: json.privateaddress == null ? [] : [SaplingPaymentAddress_1.SaplingPaymentAddress.fromAddressString(json.privateaddress)],\n            unlock_after: new bn_js_1.BN(json.timelock, 10)\n        });\n    }\n}\nexports.Identity = Identity;\nIdentity.VERSION_INVALID = new bn_js_1.BN(0);\nIdentity.VERSION_VERUSID = new bn_js_1.BN(1);\nIdentity.VERSION_VAULT = new bn_js_1.BN(2);\nIdentity.VERSION_PBAAS = new bn_js_1.BN(3);\nIdentity.VERSION_CURRENT = Identity.VERSION_PBAAS;\nIdentity.VERSION_FIRSTVALID = new bn_js_1.BN(1);\nIdentity.VERSION_LASTVALID = new bn_js_1.BN(3);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script"}