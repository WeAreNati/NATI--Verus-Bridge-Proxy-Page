{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst axios_1 = __importDefault(require(\"axios\"));\nconst verus_typescript_primitives_1 = require(\"verus-typescript-primitives\");\nconst flags_1 = require(\"./utils/flags\");\nclass VerusdRpcInterface {\n  constructor(chain, baseURL, config, rpcRequest) {\n    this.currencycache = new Map();\n    this.converterscache = new Map();\n    this.listcurrenciescache = new Map();\n    this.infocache = null;\n    if (rpcRequest) this.rpcRequestOverride = rpcRequest;else {\n      this.instance = axios_1.default.create(Object.assign({\n        baseURL,\n        headers: {\n          \"Content-type\": \"application/json\"\n        }\n      }, config));\n    }\n    this.currid = 0;\n    this.chain = chain;\n  }\n  request(req) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const id = this.currid;\n      this.currid += 1;\n      const body = {\n        jsonrpc: \"1.0\",\n        id,\n        params: req.getParams(),\n        method: req.cmd\n      };\n      if (this.rpcRequestOverride) return this.rpcRequestOverride(body);\n      try {\n        const res = yield this.instance.post(\"/\", body);\n        if (res.status != 200) {\n          const error = {\n            id,\n            result: null,\n            error: {\n              code: res.status,\n              message: \"Network error \".concat(res.status),\n              data: res.data\n            }\n          };\n          return error;\n        } else {\n          const response = res.data;\n          return response;\n        }\n      } catch (e) {\n        const error = {\n          id,\n          result: null,\n          error: {\n            code: -32603,\n            message: e.message\n          }\n        };\n        return error;\n      }\n    });\n  }\n  getAddressBalance() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    return this.request(new verus_typescript_primitives_1.GetAddressBalanceRequest(this.chain, ...args));\n  }\n  getAddressDeltas() {\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n    return this.request(new verus_typescript_primitives_1.GetAddressDeltasRequest(this.chain, ...args));\n  }\n  getAddressMempool() {\n    for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      args[_key3] = arguments[_key3];\n    }\n    return this.request(new verus_typescript_primitives_1.GetAddressMempoolRequest(this.chain, ...args));\n  }\n  getAddressUtxos() {\n    for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n      args[_key4] = arguments[_key4];\n    }\n    return this.request(new verus_typescript_primitives_1.GetAddressUtxosRequest(this.chain, ...args));\n  }\n  getBlock() {\n    for (var _len5 = arguments.length, args = new Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {\n      args[_key5] = arguments[_key5];\n    }\n    return this.request(new verus_typescript_primitives_1.GetBlockRequest(this.chain, ...args));\n  }\n  getVdxfId() {\n    for (var _len6 = arguments.length, args = new Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {\n      args[_key6] = arguments[_key6];\n    }\n    return this.request(new verus_typescript_primitives_1.GetVdxfIdRequest(this.chain, ...args));\n  }\n  getIdentity() {\n    for (var _len7 = arguments.length, args = new Array(_len7), _key7 = 0; _key7 < _len7; _key7++) {\n      args[_key7] = arguments[_key7];\n    }\n    return this.request(new verus_typescript_primitives_1.GetIdentityRequest(this.chain, ...args));\n  }\n  getCurrency() {\n    for (var _len8 = arguments.length, args = new Array(_len8), _key8 = 0; _key8 < _len8; _key8++) {\n      args[_key8] = arguments[_key8];\n    }\n    return this.request(new verus_typescript_primitives_1.GetCurrencyRequest(this.chain, ...args));\n  }\n  getInfo() {\n    for (var _len9 = arguments.length, args = new Array(_len9), _key9 = 0; _key9 < _len9; _key9++) {\n      args[_key9] = arguments[_key9];\n    }\n    return this.request(new verus_typescript_primitives_1.GetInfoRequest(this.chain, ...args));\n  }\n  getOffers() {\n    for (var _len10 = arguments.length, args = new Array(_len10), _key10 = 0; _key10 < _len10; _key10++) {\n      args[_key10] = arguments[_key10];\n    }\n    return this.request(new verus_typescript_primitives_1.GetOffersRequest(this.chain, ...args));\n  }\n  getRawTransaction() {\n    for (var _len11 = arguments.length, args = new Array(_len11), _key11 = 0; _key11 < _len11; _key11++) {\n      args[_key11] = arguments[_key11];\n    }\n    return this.request(new verus_typescript_primitives_1.GetRawTransactionRequest(this.chain, ...args));\n  }\n  makeOffer() {\n    for (var _len12 = arguments.length, args = new Array(_len12), _key12 = 0; _key12 < _len12; _key12++) {\n      args[_key12] = arguments[_key12];\n    }\n    return this.request(new verus_typescript_primitives_1.MakeOfferRequest(this.chain, ...args));\n  }\n  sendRawTransaction() {\n    for (var _len13 = arguments.length, args = new Array(_len13), _key13 = 0; _key13 < _len13; _key13++) {\n      args[_key13] = arguments[_key13];\n    }\n    return this.request(new verus_typescript_primitives_1.SendRawTransactionRequest(this.chain, ...args));\n  }\n  fundRawTransaction() {\n    for (var _len14 = arguments.length, args = new Array(_len14), _key14 = 0; _key14 < _len14; _key14++) {\n      args[_key14] = arguments[_key14];\n    }\n    return this.request(new verus_typescript_primitives_1.FundRawTransactionRequest(this.chain, ...args));\n  }\n  sendCurrency() {\n    for (var _len15 = arguments.length, args = new Array(_len15), _key15 = 0; _key15 < _len15; _key15++) {\n      args[_key15] = arguments[_key15];\n    }\n    return this.request(new verus_typescript_primitives_1.SendCurrencyRequest(this.chain, ...args));\n  }\n  getCurrencyConverters() {\n    for (var _len16 = arguments.length, args = new Array(_len16), _key16 = 0; _key16 < _len16; _key16++) {\n      args[_key16] = arguments[_key16];\n    }\n    return this.request(new verus_typescript_primitives_1.GetCurrencyConvertersRequest(this.chain, ...args));\n  }\n  listCurrencies() {\n    for (var _len17 = arguments.length, args = new Array(_len17), _key17 = 0; _key17 < _len17; _key17++) {\n      args[_key17] = arguments[_key17];\n    }\n    return this.request(new verus_typescript_primitives_1.ListCurrenciesRequest(this.chain, ...args));\n  }\n  estimateConversion() {\n    for (var _len18 = arguments.length, args = new Array(_len18), _key18 = 0; _key18 < _len18; _key18++) {\n      args[_key18] = arguments[_key18];\n    }\n    return this.request(new verus_typescript_primitives_1.EstimateConversionRequest(this.chain, ...args));\n  }\n  static extractRpcResult(res) {\n    if (res.error) throw new Error(res.error.message);else return res.result;\n  }\n  getCachedCurrency() {\n    for (var _len19 = arguments.length, args = new Array(_len19), _key19 = 0; _key19 < _len19; _key19++) {\n      args[_key19] = arguments[_key19];\n    }\n    return __awaiter(this, void 0, void 0, function* () {\n      const [iaddr] = args;\n      if (this.currencycache.has(iaddr)) {\n        return this.currencycache.get(iaddr);\n      }\n      const response = yield this.request(new verus_typescript_primitives_1.GetCurrencyRequest(this.chain, ...args));\n      if (response.result) {\n        this.currencycache.set(iaddr, response);\n      }\n      return response;\n    });\n  }\n  getCachedInfo() {\n    for (var _len20 = arguments.length, args = new Array(_len20), _key20 = 0; _key20 < _len20; _key20++) {\n      args[_key20] = arguments[_key20];\n    }\n    return __awaiter(this, void 0, void 0, function* () {\n      if (this.infocache != null) {\n        return this.infocache;\n      }\n      const response = yield this.request(new verus_typescript_primitives_1.GetInfoRequest(this.chain, ...args));\n      if (response.result) {\n        this.infocache = response;\n      }\n      return response;\n    });\n  }\n  getCachedListCurrencies() {\n    for (var _len21 = arguments.length, args = new Array(_len21), _key21 = 0; _key21 < _len21; _key21++) {\n      args[_key21] = arguments[_key21];\n    }\n    return __awaiter(this, void 0, void 0, function* () {\n      const key = JSON.stringify(args);\n      if (this.listcurrenciescache.has(key)) {\n        return this.listcurrenciescache.get(key);\n      }\n      const response = yield this.request(new verus_typescript_primitives_1.ListCurrenciesRequest(this.chain, ...args));\n      if (response.result) {\n        this.listcurrenciescache.set(key, response);\n      }\n      return response;\n    });\n  }\n  getAllCachedListCurrencies() {\n    return __awaiter(this, void 0, void 0, function* () {\n      const localCurrencies = VerusdRpcInterface.extractRpcResult(yield this.getCachedListCurrencies({\n        systemtype: \"local\"\n      }));\n      const pbaasCurrencies = VerusdRpcInterface.extractRpcResult(yield this.getCachedListCurrencies({\n        systemtype: \"pbaas\"\n      }));\n      const importedCurrencies = VerusdRpcInterface.extractRpcResult(yield this.getCachedListCurrencies({\n        systemtype: \"imported\"\n      }));\n      const allCurrencies = [...localCurrencies, ...pbaasCurrencies, ...importedCurrencies];\n      const seenCurrencies = new Set();\n      return allCurrencies.filter(x => {\n        if (seenCurrencies.has(x.currencydefinition.currencyid)) return false;else {\n          seenCurrencies.add(x.currencydefinition.currencyid);\n          return true;\n        }\n      });\n    });\n  }\n  getCachedCurrencyConverters() {\n    for (var _len22 = arguments.length, args = new Array(_len22), _key22 = 0; _key22 < _len22; _key22++) {\n      args[_key22] = arguments[_key22];\n    }\n    return __awaiter(this, void 0, void 0, function* () {\n      const key = JSON.stringify(args);\n      if (this.converterscache.has(key)) {\n        return this.converterscache.get(key);\n      }\n      const allCurrencies = yield this.getAllCachedListCurrencies();\n      const root = VerusdRpcInterface.extractRpcResult(yield this.getCachedCurrency(this.chain));\n      const chainInfo = VerusdRpcInterface.extractRpcResult(yield this.getCachedInfo());\n      // Try to cache locally constructed converter responses\n      for (const source of allCurrencies) {\n        const sourceDefinition = source.currencydefinition;\n        const converters = [];\n        for (const dest of allCurrencies) {\n          const destDefinition = dest.currencydefinition;\n          if (destDefinition.currencies && destDefinition.currencies.includes(sourceDefinition.currencyid) && dest.bestcurrencystate) {\n            if (destDefinition.startblock > chainInfo.longestchain && !(destDefinition.maxpreconversion && destDefinition.maxpreconversion.reduce((sum, a) => sum + a, 0) === 0)) {\n              converters.push({\n                [destDefinition.name]: Object.assign(Object.assign({}, destDefinition), {\n                  bestcurrencystate: dest.bestcurrencystate\n                })\n              });\n            } else if ((0, flags_1.checkFlag)(destDefinition.options, flags_1.IS_FRACTIONAL_FLAG)) {\n              const targetReserve = dest.bestcurrencystate.reservecurrencies.find(x => x.currencyid === root.currencyid);\n              const systemReserve = dest.bestcurrencystate.reservecurrencies.find(x => x.currencyid === this.chain);\n              if (targetReserve && targetReserve.weight > 0.1 && systemReserve && systemReserve.reserves > 1000) {\n                converters.push({\n                  [destDefinition.name]: Object.assign(Object.assign({}, destDefinition), {\n                    bestcurrencystate: dest.bestcurrencystate\n                  })\n                });\n              }\n            }\n          }\n        }\n        const params = [[sourceDefinition.currencyid]];\n        const converterResponse = {\n          id: 0,\n          result: converters,\n          error: null\n        };\n        this.converterscache.set(JSON.stringify(params), converterResponse);\n      }\n      if (!this.converterscache.has(key)) {\n        const response = yield this.request(new verus_typescript_primitives_1.GetCurrencyConvertersRequest(this.chain, ...args));\n        if (response.result) {\n          this.converterscache.set(key, response);\n        }\n        return response;\n      } else {\n        return this.converterscache.get(key);\n      }\n    });\n  }\n  getCurrencyConversionPathsRec(src, dest) {\n    let includeVia = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n    let ignoreCurrencies = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : [];\n    let via = arguments.length > 4 ? arguments[4] : undefined;\n    let root = arguments.length > 5 ? arguments[5] : undefined;\n    return __awaiter(this, void 0, void 0, function* () {\n      const currChainDefinition = VerusdRpcInterface.extractRpcResult(yield this.getCachedCurrency(this.chain));\n      const fractionalSource = (0, flags_1.checkFlag)(src.options, flags_1.IS_FRACTIONAL_FLAG) && src.systemid === currChainDefinition.currencyid;\n      const paths = VerusdRpcInterface.extractRpcResult(yield this.getCachedCurrencyConverters(dest == null ? [src.currencyid] : [src.currencyid, dest.currencyid]));\n      let convertables = {};\n      function addConvertable(key, convertable) {\n        if (convertables[key] == null) {\n          convertables[key] = [convertable];\n        } else {\n          convertables[key].push(convertable);\n        }\n      }\n      function mergeConvertables(x, y) {\n        const merged = {};\n        for (const key in x) {\n          if (y[key]) {\n            merged[key] = x[key];\n            for (const conv of y[key]) {\n              const existingConvertable = x[key].find(x => {\n                return x.destination === conv.destination && x.via === conv.via && x.exportto === conv.exportto;\n              });\n              if (existingConvertable == null) merged[key].push(conv);\n            }\n          } else {\n            merged[key] = x[key];\n          }\n        }\n        for (const key in y) {\n          if (!merged[key]) {\n            merged[key] = y[key];\n          }\n        }\n        convertables = merged;\n      }\n      destination_iterator: for (const path of paths) {\n        const currencyName = Object.keys(path)[0];\n        const fullCurrencyDefinition = VerusdRpcInterface.extractRpcResult(yield this.getCachedCurrency(path[currencyName].currencyid));\n        let pricingCurrencyState;\n        let price;\n        let viapriceinroot;\n        let destpriceinvia;\n        if (via) {\n          if (via.bestcurrencystate) {\n            pricingCurrencyState = via.bestcurrencystate;\n          } else {\n            pricingCurrencyState = VerusdRpcInterface.extractRpcResult(yield this.getCachedCurrency(via.currencyid)).bestcurrencystate;\n          }\n          // If the pricingCurrency doesn't contain the destination\n          // in it's reserves, we can't use it for via\n          if (pricingCurrencyState.currencies[fullCurrencyDefinition.currencyid] == null) {\n            continue;\n          }\n          viapriceinroot = 1 / pricingCurrencyState.currencies[root.currencyid].lastconversionprice;\n          destpriceinvia = pricingCurrencyState.currencies[fullCurrencyDefinition.currencyid].lastconversionprice;\n          price = 1 / (pricingCurrencyState.currencies[root.currencyid].lastconversionprice / pricingCurrencyState.currencies[fullCurrencyDefinition.currencyid].lastconversionprice);\n        } else {\n          if (fullCurrencyDefinition.bestcurrencystate) {\n            pricingCurrencyState = fullCurrencyDefinition.bestcurrencystate;\n          } else {\n            pricingCurrencyState = VerusdRpcInterface.extractRpcResult(yield this.getCachedCurrency(fullCurrencyDefinition.currencyid)).bestcurrencystate;\n          }\n          price = 1 / pricingCurrencyState.currencies[src.currencyid].lastconversionprice;\n        }\n        const gateway = (0, flags_1.checkFlag)(fullCurrencyDefinition.options, flags_1.IS_GATEWAY_FLAG);\n        const gatewayConverter = (0, flags_1.checkFlag)(fullCurrencyDefinition.options, flags_1.IS_GATEWAY_CONVERTER_FLAG) || (0, flags_1.checkFlag)(src.options, flags_1.IS_GATEWAY_CONVERTER_FLAG) || via != null && (0, flags_1.checkFlag)(via.options, flags_1.IS_GATEWAY_CONVERTER_FLAG);\n        const fractionalConverter = via ? via : fullCurrencyDefinition;\n        addConvertable(fullCurrencyDefinition.currencyid, {\n          via,\n          destination: fullCurrencyDefinition,\n          exportto: gateway || gatewayConverter ? VerusdRpcInterface.extractRpcResult(yield this.getCachedCurrency(gateway ? fullCurrencyDefinition.currencyid : fractionalConverter.parent === this.chain ? fractionalConverter.launchsystemid : fractionalConverter.parent)) : undefined,\n          price,\n          gateway,\n          viapriceinroot,\n          destpriceinvia\n        });\n        // If gateway converter, allow converting to same currency, on current system\n        if (gateway || gatewayConverter) {\n          const convertableArr = convertables[fullCurrencyDefinition.currencyid];\n          const existingOnChainConversion = convertableArr != null ? convertableArr.find(x => x.exportto == null) : null;\n          if (existingOnChainConversion == null) {\n            addConvertable(fullCurrencyDefinition.currencyid, {\n              via,\n              destination: fullCurrencyDefinition,\n              price,\n              gateway: false,\n              viapriceinroot,\n              destpriceinvia\n            });\n          }\n        }\n      }\n      if (fractionalSource && dest == null) {\n        let price;\n        let viapriceinroot;\n        let destpriceinvia;\n        for (const reserve of src.currencies) {\n          let pricingCurrencyState;\n          if (!ignoreCurrencies.includes(reserve)) {\n            if (via) {\n              if (via.bestcurrencystate) {\n                pricingCurrencyState = via.bestcurrencystate;\n              } else {\n                pricingCurrencyState = VerusdRpcInterface.extractRpcResult(yield this.getCachedCurrency(via.currencyid)).bestcurrencystate;\n              }\n              viapriceinroot = 1 / pricingCurrencyState.currencies[root.currencyid].lastconversionprice;\n              destpriceinvia = pricingCurrencyState.currencies[reserve].lastconversionprice;\n              price = 1 / (pricingCurrencyState.currencies[root.currencyid].lastconversionprice / pricingCurrencyState.currencies[reserve].lastconversionprice);\n            } else {\n              if (src.bestcurrencystate) {\n                pricingCurrencyState = src.bestcurrencystate;\n              } else {\n                pricingCurrencyState = VerusdRpcInterface.extractRpcResult(yield this.getCachedCurrency(src.currencyid)).bestcurrencystate;\n              }\n              price = pricingCurrencyState.currencies[reserve].lastconversionprice;\n            }\n            const _destination = VerusdRpcInterface.extractRpcResult(yield this.getCachedCurrency(reserve));\n            const gateway = (0, flags_1.checkFlag)(_destination.options, flags_1.IS_GATEWAY_FLAG);\n            const gatewayConverter = (0, flags_1.checkFlag)(_destination.options, flags_1.IS_GATEWAY_CONVERTER_FLAG) || (0, flags_1.checkFlag)(src.options, flags_1.IS_GATEWAY_CONVERTER_FLAG) || via != null && (0, flags_1.checkFlag)(via.options, flags_1.IS_GATEWAY_CONVERTER_FLAG);\n            const fractionalConverter = via ? via : src;\n            addConvertable(reserve, {\n              via,\n              destination: _destination,\n              exportto: gateway || gatewayConverter ? VerusdRpcInterface.extractRpcResult(yield this.getCachedCurrency(gateway ? _destination.currencyid : fractionalConverter.parent === this.chain ? fractionalConverter.launchsystemid : fractionalConverter.parent)) : undefined,\n              price,\n              viapriceinroot,\n              destpriceinvia,\n              gateway\n            });\n            // If gateway converter, allow converting to same currency, on current system\n            if (gateway || gatewayConverter) {\n              const convertableArr = convertables[reserve];\n              const existingOnChainConversion = convertableArr != null ? convertableArr.find(x => x.exportto == null) : null;\n              if (existingOnChainConversion == null) {\n                addConvertable(reserve, {\n                  via,\n                  destination: _destination,\n                  price,\n                  gateway: false,\n                  viapriceinroot,\n                  destpriceinvia\n                });\n              }\n            }\n          }\n        }\n      }\n      if (includeVia) {\n        const chainInfo = VerusdRpcInterface.extractRpcResult(yield this.getCachedInfo());\n        for (const key in convertables) {\n          for (const convertablePath of convertables[key]) {\n            const started = convertablePath.destination.startblock <= chainInfo.longestchain || convertablePath.destination.launchsystemid !== chainInfo.chainid;\n            if ((0, flags_1.checkFlag)(convertablePath.destination.options, flags_1.IS_FRACTIONAL_FLAG) && !ignoreCurrencies.includes(key) && convertablePath.destination.currencies.includes(src.currencyid) && started) {\n              mergeConvertables(convertables, yield this._getCurrencyConversionPaths(convertablePath.destination, dest, false, ignoreCurrencies, convertablePath.destination, src));\n            }\n          }\n        }\n      }\n      // Rules:\n      // The systemid of the fractional currency determines if exportto must be present or not.\n      // If using via, the via is always the fractional currency.\n      // If not using via, check both source and dest for fractional flag.\n      for (const key in convertables) {\n        const convertableArr = convertables[key];\n        convertables[key] = convertableArr.filter(x => {\n          const convertable = x;\n          let fractionalConverter;\n          if (convertable.via) fractionalConverter = convertable.via;else {\n            const fractionalDest = (0, flags_1.checkFlag)(convertable.destination.options, flags_1.IS_FRACTIONAL_FLAG);\n            if (fractionalSource && !fractionalDest) fractionalConverter = src;else if (!fractionalSource && fractionalDest) fractionalConverter = convertable.destination;else if (src.currencies && convertable.destination.currencies) {\n              if (src.currencies.includes(convertable.destination.currencyid)) fractionalConverter = src;else fractionalConverter = convertable.destination;\n            } else return false;\n          }\n          if (fractionalConverter.systemid !== this.chain && (convertable.exportto == null || convertable.exportto.currencyid !== fractionalConverter.systemid)) return false;else if (convertable.exportto != null) {\n            // Make sure you only export to currencies that can see the chain you're on\n            const seeByLaunch = convertable.exportto.launchsystemid === currChainDefinition.currencyid || currChainDefinition.launchsystemid === convertable.exportto.currencyid;\n            const seeByParent = convertable.exportto.parent === currChainDefinition.currencyid || currChainDefinition.parent === convertable.exportto.currencyid;\n            return seeByLaunch || seeByParent;\n          } else return true;\n        });\n      }\n      return convertables;\n    });\n  }\n  _getCurrencyConversionPaths(src, dest) {\n    let includeVia = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n    let ignoreCurrencies = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : [];\n    let via = arguments.length > 4 ? arguments[4] : undefined;\n    let root = arguments.length > 5 ? arguments[5] : undefined;\n    return __awaiter(this, void 0, void 0, function* () {\n      const paths = yield this.getCurrencyConversionPathsRec(src, dest, includeVia, ignoreCurrencies, via, root);\n      delete paths[src.currencyid];\n      return paths;\n    });\n  }\n  getCurrencyConversionPaths(src, dest) {\n    let includeVia = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n    let ignoreCurrencies = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : [];\n    let via = arguments.length > 4 ? arguments[4] : undefined;\n    let root = arguments.length > 5 ? arguments[5] : undefined;\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        const _cache = this.currencycache;\n        function cacheDefinition(x) {\n          _cache.set(x.currencyid, {\n            id: 0,\n            result: x,\n            error: null\n          });\n        }\n        cacheDefinition(src);\n        if (dest != null) {\n          cacheDefinition(dest);\n        }\n        if (via != null) {\n          cacheDefinition(via);\n        }\n        if (root != null) {\n          cacheDefinition(root);\n        }\n        const allCurrencies = yield this.getAllCachedListCurrencies();\n        for (const currency of allCurrencies) {\n          const definition = Object.assign(Object.assign({}, currency.currencydefinition), {\n            bestcurrencystate: currency.bestcurrencystate\n          });\n          const getCurrencyResponse = {\n            id: 0,\n            result: definition,\n            error: null\n          };\n          this.currencycache.set(definition.currencyid, getCurrencyResponse);\n        }\n        const result = yield this._getCurrencyConversionPaths(src, dest, includeVia, ignoreCurrencies, via, root);\n        this.currencycache.clear();\n        this.listcurrenciescache.clear();\n        this.converterscache.clear();\n        this.infocache = null;\n        return result;\n      } catch (e) {\n        this.currencycache.clear();\n        this.listcurrenciescache.clear();\n        this.converterscache.clear();\n        this.infocache = null;\n        throw e;\n      }\n    });\n  }\n}\nexports.default = VerusdRpcInterface;","map":{"version":3,"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__importDefault","mod","__esModule","Object","defineProperty","exports","axios_1","require","verus_typescript_primitives_1","flags_1","VerusdRpcInterface","constructor","chain","baseURL","config","rpcRequest","currencycache","Map","converterscache","listcurrenciescache","infocache","rpcRequestOverride","instance","default","create","assign","headers","currid","request","req","id","body","jsonrpc","params","getParams","method","cmd","res","post","status","error","code","message","concat","data","response","getAddressBalance","_len","arguments","length","args","Array","_key","GetAddressBalanceRequest","getAddressDeltas","_len2","_key2","GetAddressDeltasRequest","getAddressMempool","_len3","_key3","GetAddressMempoolRequest","getAddressUtxos","_len4","_key4","GetAddressUtxosRequest","getBlock","_len5","_key5","GetBlockRequest","getVdxfId","_len6","_key6","GetVdxfIdRequest","getIdentity","_len7","_key7","GetIdentityRequest","getCurrency","_len8","_key8","GetCurrencyRequest","getInfo","_len9","_key9","GetInfoRequest","getOffers","_len10","_key10","GetOffersRequest","getRawTransaction","_len11","_key11","GetRawTransactionRequest","makeOffer","_len12","_key12","MakeOfferRequest","sendRawTransaction","_len13","_key13","SendRawTransactionRequest","fundRawTransaction","_len14","_key14","FundRawTransactionRequest","sendCurrency","_len15","_key15","SendCurrencyRequest","getCurrencyConverters","_len16","_key16","GetCurrencyConvertersRequest","listCurrencies","_len17","_key17","ListCurrenciesRequest","estimateConversion","_len18","_key18","EstimateConversionRequest","extractRpcResult","Error","getCachedCurrency","_len19","_key19","iaddr","has","get","set","getCachedInfo","_len20","_key20","getCachedListCurrencies","_len21","_key21","key","JSON","stringify","getAllCachedListCurrencies","localCurrencies","systemtype","pbaasCurrencies","importedCurrencies","allCurrencies","seenCurrencies","Set","filter","x","currencydefinition","currencyid","add","getCachedCurrencyConverters","_len22","_key22","root","chainInfo","source","sourceDefinition","converters","dest","destDefinition","currencies","includes","bestcurrencystate","startblock","longestchain","maxpreconversion","reduce","sum","a","push","name","checkFlag","options","IS_FRACTIONAL_FLAG","targetReserve","reservecurrencies","find","systemReserve","weight","reserves","converterResponse","getCurrencyConversionPathsRec","src","includeVia","undefined","ignoreCurrencies","via","currChainDefinition","fractionalSource","systemid","paths","convertables","addConvertable","convertable","mergeConvertables","y","merged","conv","existingConvertable","destination","exportto","destination_iterator","path","currencyName","keys","fullCurrencyDefinition","pricingCurrencyState","price","viapriceinroot","destpriceinvia","lastconversionprice","gateway","IS_GATEWAY_FLAG","gatewayConverter","IS_GATEWAY_CONVERTER_FLAG","fractionalConverter","parent","launchsystemid","convertableArr","existingOnChainConversion","reserve","_destination","convertablePath","started","chainid","_getCurrencyConversionPaths","fractionalDest","seeByLaunch","seeByParent","getCurrencyConversionPaths","_cache","cacheDefinition","currency","definition","getCurrencyResponse","clear"],"sources":["/Users/oddfl3x/Code/varB/vARRRBridgeWebsite-main/node_modules/verusd-rpc-ts-client/lib/VerusdRpcInterface.js"],"sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst axios_1 = __importDefault(require(\"axios\"));\nconst verus_typescript_primitives_1 = require(\"verus-typescript-primitives\");\nconst flags_1 = require(\"./utils/flags\");\nclass VerusdRpcInterface {\n    constructor(chain, baseURL, config, rpcRequest) {\n        this.currencycache = new Map();\n        this.converterscache = new Map();\n        this.listcurrenciescache = new Map();\n        this.infocache = null;\n        if (rpcRequest)\n            this.rpcRequestOverride = rpcRequest;\n        else {\n            this.instance = axios_1.default.create(Object.assign({ baseURL, headers: {\n                    \"Content-type\": \"application/json\",\n                } }, config));\n        }\n        this.currid = 0;\n        this.chain = chain;\n    }\n    request(req) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const id = this.currid;\n            this.currid += 1;\n            const body = {\n                jsonrpc: \"1.0\",\n                id,\n                params: req.getParams(),\n                method: req.cmd,\n            };\n            if (this.rpcRequestOverride)\n                return this.rpcRequestOverride(body);\n            try {\n                const res = yield this.instance.post(\"/\", body);\n                if (res.status != 200) {\n                    const error = {\n                        id,\n                        result: null,\n                        error: {\n                            code: res.status,\n                            message: `Network error ${res.status}`,\n                            data: res.data,\n                        },\n                    };\n                    return error;\n                }\n                else {\n                    const response = res.data;\n                    return response;\n                }\n            }\n            catch (e) {\n                const error = {\n                    id,\n                    result: null,\n                    error: {\n                        code: -32603,\n                        message: e.message,\n                    },\n                };\n                return error;\n            }\n        });\n    }\n    getAddressBalance(...args) {\n        return this.request(new verus_typescript_primitives_1.GetAddressBalanceRequest(this.chain, ...args));\n    }\n    getAddressDeltas(...args) {\n        return this.request(new verus_typescript_primitives_1.GetAddressDeltasRequest(this.chain, ...args));\n    }\n    getAddressMempool(...args) {\n        return this.request(new verus_typescript_primitives_1.GetAddressMempoolRequest(this.chain, ...args));\n    }\n    getAddressUtxos(...args) {\n        return this.request(new verus_typescript_primitives_1.GetAddressUtxosRequest(this.chain, ...args));\n    }\n    getBlock(...args) {\n        return this.request(new verus_typescript_primitives_1.GetBlockRequest(this.chain, ...args));\n    }\n    getVdxfId(...args) {\n        return this.request(new verus_typescript_primitives_1.GetVdxfIdRequest(this.chain, ...args));\n    }\n    getIdentity(...args) {\n        return this.request(new verus_typescript_primitives_1.GetIdentityRequest(this.chain, ...args));\n    }\n    getCurrency(...args) {\n        return this.request(new verus_typescript_primitives_1.GetCurrencyRequest(this.chain, ...args));\n    }\n    getInfo(...args) {\n        return this.request(new verus_typescript_primitives_1.GetInfoRequest(this.chain, ...args));\n    }\n    getOffers(...args) {\n        return this.request(new verus_typescript_primitives_1.GetOffersRequest(this.chain, ...args));\n    }\n    getRawTransaction(...args) {\n        return this.request(new verus_typescript_primitives_1.GetRawTransactionRequest(this.chain, ...args));\n    }\n    makeOffer(...args) {\n        return this.request(new verus_typescript_primitives_1.MakeOfferRequest(this.chain, ...args));\n    }\n    sendRawTransaction(...args) {\n        return this.request(new verus_typescript_primitives_1.SendRawTransactionRequest(this.chain, ...args));\n    }\n    fundRawTransaction(...args) {\n        return this.request(new verus_typescript_primitives_1.FundRawTransactionRequest(this.chain, ...args));\n    }\n    sendCurrency(...args) {\n        return this.request(new verus_typescript_primitives_1.SendCurrencyRequest(this.chain, ...args));\n    }\n    getCurrencyConverters(...args) {\n        return this.request(new verus_typescript_primitives_1.GetCurrencyConvertersRequest(this.chain, ...args));\n    }\n    listCurrencies(...args) {\n        return this.request(new verus_typescript_primitives_1.ListCurrenciesRequest(this.chain, ...args));\n    }\n    estimateConversion(...args) {\n        return this.request(new verus_typescript_primitives_1.EstimateConversionRequest(this.chain, ...args));\n    }\n    static extractRpcResult(res) {\n        if (res.error)\n            throw new Error(res.error.message);\n        else\n            return res.result;\n    }\n    getCachedCurrency(...args) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const [iaddr] = args;\n            if (this.currencycache.has(iaddr)) {\n                return this.currencycache.get(iaddr);\n            }\n            const response = yield this.request(new verus_typescript_primitives_1.GetCurrencyRequest(this.chain, ...args));\n            if (response.result) {\n                this.currencycache.set(iaddr, response);\n            }\n            return response;\n        });\n    }\n    getCachedInfo(...args) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this.infocache != null) {\n                return this.infocache;\n            }\n            const response = yield this.request(new verus_typescript_primitives_1.GetInfoRequest(this.chain, ...args));\n            if (response.result) {\n                this.infocache = response;\n            }\n            return response;\n        });\n    }\n    getCachedListCurrencies(...args) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const key = JSON.stringify(args);\n            if (this.listcurrenciescache.has(key)) {\n                return this.listcurrenciescache.get(key);\n            }\n            const response = yield this.request(new verus_typescript_primitives_1.ListCurrenciesRequest(this.chain, ...args));\n            if (response.result) {\n                this.listcurrenciescache.set(key, response);\n            }\n            return response;\n        });\n    }\n    getAllCachedListCurrencies() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const localCurrencies = VerusdRpcInterface.extractRpcResult(yield this.getCachedListCurrencies({ systemtype: \"local\" }));\n            const pbaasCurrencies = VerusdRpcInterface.extractRpcResult(yield this.getCachedListCurrencies({ systemtype: \"pbaas\" }));\n            const importedCurrencies = VerusdRpcInterface.extractRpcResult(yield this.getCachedListCurrencies({ systemtype: \"imported\" }));\n            const allCurrencies = [...localCurrencies, ...pbaasCurrencies, ...importedCurrencies];\n            const seenCurrencies = new Set();\n            return allCurrencies.filter(x => {\n                if (seenCurrencies.has(x.currencydefinition.currencyid))\n                    return false;\n                else {\n                    seenCurrencies.add(x.currencydefinition.currencyid);\n                    return true;\n                }\n            });\n        });\n    }\n    getCachedCurrencyConverters(...args) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const key = JSON.stringify(args);\n            if (this.converterscache.has(key)) {\n                return this.converterscache.get(key);\n            }\n            const allCurrencies = yield this.getAllCachedListCurrencies();\n            const root = (VerusdRpcInterface.extractRpcResult(yield this.getCachedCurrency(this.chain)));\n            const chainInfo = (VerusdRpcInterface.extractRpcResult(yield this.getCachedInfo()));\n            // Try to cache locally constructed converter responses\n            for (const source of allCurrencies) {\n                const sourceDefinition = source.currencydefinition;\n                const converters = [];\n                for (const dest of allCurrencies) {\n                    const destDefinition = dest.currencydefinition;\n                    if (destDefinition.currencies &&\n                        destDefinition.currencies.includes(sourceDefinition.currencyid) &&\n                        dest.bestcurrencystate) {\n                        if (destDefinition.startblock > chainInfo.longestchain &&\n                            !(destDefinition.maxpreconversion && destDefinition.maxpreconversion.reduce((sum, a) => sum + a, 0) === 0)) {\n                            converters.push({\n                                [destDefinition.name]: Object.assign(Object.assign({}, destDefinition), { bestcurrencystate: dest.bestcurrencystate })\n                            });\n                        }\n                        else if ((0, flags_1.checkFlag)(destDefinition.options, flags_1.IS_FRACTIONAL_FLAG)) {\n                            const targetReserve = dest.bestcurrencystate.reservecurrencies.find(x => x.currencyid === root.currencyid);\n                            const systemReserve = dest.bestcurrencystate.reservecurrencies.find(x => x.currencyid === this.chain);\n                            if (targetReserve && targetReserve.weight > 0.1 && systemReserve && systemReserve.reserves > 1000) {\n                                converters.push({\n                                    [destDefinition.name]: Object.assign(Object.assign({}, destDefinition), { bestcurrencystate: dest.bestcurrencystate })\n                                });\n                            }\n                        }\n                    }\n                }\n                const params = [[sourceDefinition.currencyid]];\n                const converterResponse = {\n                    id: 0,\n                    result: converters,\n                    error: null\n                };\n                this.converterscache.set(JSON.stringify(params), converterResponse);\n            }\n            if (!this.converterscache.has(key)) {\n                const response = yield this.request(new verus_typescript_primitives_1.GetCurrencyConvertersRequest(this.chain, ...args));\n                if (response.result) {\n                    this.converterscache.set(key, response);\n                }\n                return response;\n            }\n            else {\n                return this.converterscache.get(key);\n            }\n        });\n    }\n    getCurrencyConversionPathsRec(src, dest, includeVia = true, ignoreCurrencies = [], via, root) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const currChainDefinition = (VerusdRpcInterface.extractRpcResult(yield this.getCachedCurrency(this.chain)));\n            const fractionalSource = (0, flags_1.checkFlag)(src.options, flags_1.IS_FRACTIONAL_FLAG) && (src.systemid === currChainDefinition.currencyid);\n            const paths = VerusdRpcInterface.extractRpcResult(yield this.getCachedCurrencyConverters(dest == null ? [src.currencyid] : [src.currencyid, dest.currencyid]));\n            let convertables = {};\n            function addConvertable(key, convertable) {\n                if (convertables[key] == null) {\n                    convertables[key] = [convertable];\n                }\n                else {\n                    convertables[key].push(convertable);\n                }\n            }\n            function mergeConvertables(x, y) {\n                const merged = {};\n                for (const key in x) {\n                    if (y[key]) {\n                        merged[key] = x[key];\n                        for (const conv of y[key]) {\n                            const existingConvertable = x[key].find(x => {\n                                return x.destination === conv.destination && x.via === conv.via && x.exportto === conv.exportto;\n                            });\n                            if (existingConvertable == null)\n                                merged[key].push(conv);\n                        }\n                    }\n                    else {\n                        merged[key] = x[key];\n                    }\n                }\n                for (const key in y) {\n                    if (!merged[key]) {\n                        merged[key] = y[key];\n                    }\n                }\n                convertables = merged;\n            }\n            destination_iterator: for (const path of paths) {\n                const currencyName = Object.keys(path)[0];\n                const fullCurrencyDefinition = (VerusdRpcInterface.extractRpcResult(yield this.getCachedCurrency(path[currencyName].currencyid)));\n                let pricingCurrencyState;\n                let price;\n                let viapriceinroot;\n                let destpriceinvia;\n                if (via) {\n                    if (via.bestcurrencystate) {\n                        pricingCurrencyState = via.bestcurrencystate;\n                    }\n                    else {\n                        pricingCurrencyState = (VerusdRpcInterface.extractRpcResult(yield this.getCachedCurrency(via.currencyid))).bestcurrencystate;\n                    }\n                    // If the pricingCurrency doesn't contain the destination\n                    // in it's reserves, we can't use it for via\n                    if (pricingCurrencyState.currencies[fullCurrencyDefinition.currencyid] == null) {\n                        continue;\n                    }\n                    viapriceinroot = 1 / pricingCurrencyState.currencies[root.currencyid].lastconversionprice;\n                    destpriceinvia = pricingCurrencyState.currencies[fullCurrencyDefinition.currencyid].lastconversionprice;\n                    price =\n                        1 /\n                            (pricingCurrencyState.currencies[root.currencyid].lastconversionprice /\n                                pricingCurrencyState.currencies[fullCurrencyDefinition.currencyid]\n                                    .lastconversionprice);\n                }\n                else {\n                    if (fullCurrencyDefinition.bestcurrencystate) {\n                        pricingCurrencyState = fullCurrencyDefinition.bestcurrencystate;\n                    }\n                    else {\n                        pricingCurrencyState = (VerusdRpcInterface.extractRpcResult(yield this.getCachedCurrency(fullCurrencyDefinition.currencyid))).bestcurrencystate;\n                    }\n                    price = 1 / pricingCurrencyState.currencies[src.currencyid].lastconversionprice;\n                }\n                const gateway = (0, flags_1.checkFlag)(fullCurrencyDefinition.options, flags_1.IS_GATEWAY_FLAG);\n                const gatewayConverter = ((0, flags_1.checkFlag)(fullCurrencyDefinition.options, flags_1.IS_GATEWAY_CONVERTER_FLAG) ||\n                    (0, flags_1.checkFlag)(src.options, flags_1.IS_GATEWAY_CONVERTER_FLAG) ||\n                    (via != null && (0, flags_1.checkFlag)(via.options, flags_1.IS_GATEWAY_CONVERTER_FLAG)));\n                const fractionalConverter = via ? via : fullCurrencyDefinition;\n                addConvertable(fullCurrencyDefinition.currencyid, {\n                    via,\n                    destination: fullCurrencyDefinition,\n                    exportto: (gateway || gatewayConverter) ?\n                        (VerusdRpcInterface.extractRpcResult(yield this.getCachedCurrency(gateway ?\n                            fullCurrencyDefinition.currencyid\n                            :\n                                fractionalConverter.parent === this.chain ? fractionalConverter.launchsystemid : fractionalConverter.parent)))\n                        :\n                            undefined,\n                    price,\n                    gateway,\n                    viapriceinroot,\n                    destpriceinvia\n                });\n                // If gateway converter, allow converting to same currency, on current system\n                if (gateway || gatewayConverter) {\n                    const convertableArr = convertables[fullCurrencyDefinition.currencyid];\n                    const existingOnChainConversion = convertableArr != null ?\n                        convertableArr.find(x => x.exportto == null)\n                        :\n                            null;\n                    if (existingOnChainConversion == null) {\n                        addConvertable(fullCurrencyDefinition.currencyid, {\n                            via,\n                            destination: fullCurrencyDefinition,\n                            price,\n                            gateway: false,\n                            viapriceinroot,\n                            destpriceinvia\n                        });\n                    }\n                }\n            }\n            if (fractionalSource && dest == null) {\n                let price;\n                let viapriceinroot;\n                let destpriceinvia;\n                for (const reserve of src.currencies) {\n                    let pricingCurrencyState;\n                    if (!ignoreCurrencies.includes(reserve)) {\n                        if (via) {\n                            if (via.bestcurrencystate) {\n                                pricingCurrencyState = via.bestcurrencystate;\n                            }\n                            else {\n                                pricingCurrencyState = (VerusdRpcInterface.extractRpcResult(yield this.getCachedCurrency(via.currencyid))).bestcurrencystate;\n                            }\n                            viapriceinroot = 1 / pricingCurrencyState.currencies[root.currencyid].lastconversionprice;\n                            destpriceinvia = pricingCurrencyState.currencies[reserve].lastconversionprice;\n                            price =\n                                1 /\n                                    (pricingCurrencyState.currencies[root.currencyid]\n                                        .lastconversionprice /\n                                        pricingCurrencyState.currencies[reserve]\n                                            .lastconversionprice);\n                        }\n                        else {\n                            if (src.bestcurrencystate) {\n                                pricingCurrencyState = src.bestcurrencystate;\n                            }\n                            else {\n                                pricingCurrencyState = (VerusdRpcInterface.extractRpcResult(yield this.getCachedCurrency(src.currencyid))).bestcurrencystate;\n                            }\n                            price =\n                                pricingCurrencyState.currencies[reserve]\n                                    .lastconversionprice;\n                        }\n                        const _destination = (VerusdRpcInterface.extractRpcResult(yield this.getCachedCurrency(reserve)));\n                        const gateway = (0, flags_1.checkFlag)(_destination.options, flags_1.IS_GATEWAY_FLAG);\n                        const gatewayConverter = ((0, flags_1.checkFlag)(_destination.options, flags_1.IS_GATEWAY_CONVERTER_FLAG) ||\n                            (0, flags_1.checkFlag)(src.options, flags_1.IS_GATEWAY_CONVERTER_FLAG) ||\n                            (via != null && (0, flags_1.checkFlag)(via.options, flags_1.IS_GATEWAY_CONVERTER_FLAG)));\n                        const fractionalConverter = via ? via : src;\n                        addConvertable(reserve, {\n                            via,\n                            destination: _destination,\n                            exportto: (gateway || gatewayConverter) ?\n                                (VerusdRpcInterface.extractRpcResult(yield this.getCachedCurrency(gateway ?\n                                    _destination.currencyid\n                                    :\n                                        fractionalConverter.parent === this.chain ? fractionalConverter.launchsystemid : fractionalConverter.parent)))\n                                :\n                                    undefined,\n                            price,\n                            viapriceinroot,\n                            destpriceinvia,\n                            gateway\n                        });\n                        // If gateway converter, allow converting to same currency, on current system\n                        if (gateway || gatewayConverter) {\n                            const convertableArr = convertables[reserve];\n                            const existingOnChainConversion = convertableArr != null ?\n                                convertableArr.find(x => x.exportto == null)\n                                :\n                                    null;\n                            if (existingOnChainConversion == null) {\n                                addConvertable(reserve, {\n                                    via,\n                                    destination: _destination,\n                                    price,\n                                    gateway: false,\n                                    viapriceinroot,\n                                    destpriceinvia\n                                });\n                            }\n                        }\n                    }\n                }\n            }\n            if (includeVia) {\n                const chainInfo = (VerusdRpcInterface.extractRpcResult(yield this.getCachedInfo()));\n                for (const key in convertables) {\n                    for (const convertablePath of convertables[key]) {\n                        const started = ((convertablePath.destination.startblock <= chainInfo.longestchain)\n                            ||\n                                (convertablePath.destination.launchsystemid !== chainInfo.chainid));\n                        if ((0, flags_1.checkFlag)(convertablePath.destination.options, flags_1.IS_FRACTIONAL_FLAG) &&\n                            !ignoreCurrencies.includes(key) &&\n                            convertablePath.destination.currencies.includes(src.currencyid) &&\n                            started) {\n                            mergeConvertables(convertables, yield this._getCurrencyConversionPaths(convertablePath.destination, dest, false, ignoreCurrencies, convertablePath.destination, src));\n                        }\n                    }\n                }\n            }\n            // Rules:\n            // The systemid of the fractional currency determines if exportto must be present or not.\n            // If using via, the via is always the fractional currency.\n            // If not using via, check both source and dest for fractional flag.\n            for (const key in convertables) {\n                const convertableArr = convertables[key];\n                convertables[key] = convertableArr.filter(x => {\n                    const convertable = x;\n                    let fractionalConverter;\n                    if (convertable.via)\n                        fractionalConverter = convertable.via;\n                    else {\n                        const fractionalDest = (0, flags_1.checkFlag)(convertable.destination.options, flags_1.IS_FRACTIONAL_FLAG);\n                        if (fractionalSource && !fractionalDest)\n                            fractionalConverter = src;\n                        else if (!fractionalSource && fractionalDest)\n                            fractionalConverter = convertable.destination;\n                        else if (src.currencies && convertable.destination.currencies) {\n                            if (src.currencies.includes(convertable.destination.currencyid))\n                                fractionalConverter = src;\n                            else\n                                fractionalConverter = convertable.destination;\n                        }\n                        else\n                            return false;\n                    }\n                    if ((fractionalConverter.systemid !== this.chain) && (convertable.exportto == null || convertable.exportto.currencyid !== fractionalConverter.systemid))\n                        return false;\n                    else if (convertable.exportto != null) {\n                        // Make sure you only export to currencies that can see the chain you're on\n                        const seeByLaunch = convertable.exportto.launchsystemid === currChainDefinition.currencyid || currChainDefinition.launchsystemid === convertable.exportto.currencyid;\n                        const seeByParent = convertable.exportto.parent === currChainDefinition.currencyid || currChainDefinition.parent === convertable.exportto.currencyid;\n                        return seeByLaunch || seeByParent;\n                    }\n                    else\n                        return true;\n                });\n            }\n            return convertables;\n        });\n    }\n    _getCurrencyConversionPaths(src, dest, includeVia = true, ignoreCurrencies = [], via, root) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const paths = yield this.getCurrencyConversionPathsRec(src, dest, includeVia, ignoreCurrencies, via, root);\n            delete paths[src.currencyid];\n            return paths;\n        });\n    }\n    getCurrencyConversionPaths(src, dest, includeVia = true, ignoreCurrencies = [], via, root) {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                const _cache = this.currencycache;\n                function cacheDefinition(x) {\n                    _cache.set(x.currencyid, {\n                        id: 0,\n                        result: x,\n                        error: null\n                    });\n                }\n                cacheDefinition(src);\n                if (dest != null) {\n                    cacheDefinition(dest);\n                }\n                if (via != null) {\n                    cacheDefinition(via);\n                }\n                if (root != null) {\n                    cacheDefinition(root);\n                }\n                const allCurrencies = yield this.getAllCachedListCurrencies();\n                for (const currency of allCurrencies) {\n                    const definition = Object.assign(Object.assign({}, currency.currencydefinition), { bestcurrencystate: currency.bestcurrencystate });\n                    const getCurrencyResponse = {\n                        id: 0,\n                        result: definition,\n                        error: null\n                    };\n                    this.currencycache.set(definition.currencyid, getCurrencyResponse);\n                }\n                const result = yield this._getCurrencyConversionPaths(src, dest, includeVia, ignoreCurrencies, via, root);\n                this.currencycache.clear();\n                this.listcurrenciescache.clear();\n                this.converterscache.clear();\n                this.infocache = null;\n                return result;\n            }\n            catch (e) {\n                this.currencycache.clear();\n                this.listcurrenciescache.clear();\n                this.converterscache.clear();\n                this.infocache = null;\n                throw e;\n            }\n        });\n    }\n}\nexports.default = VerusdRpcInterface;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script"}